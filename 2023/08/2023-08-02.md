# 2023-08-02.md

---

## 2023å¹´08æœˆ02æ—¥ (æ°´)

---

### [â—€ï¸å‰æ—¥ã¸](https://github.com/yuasys/chatty-journal/blob/main/2023/08/2023-08-01.md)&emsp;&emsp;&emsp;&emsp;[ç¿Œæ—¥ã¸â–¶ï¸](https://github.com/yuasys/chatty-journal/blob/main/2023/08/2023-08-03.md)

---

## ä»Šæ—¥ã®ä½“é¨“è¨˜éŒ²ã€æ°—ã¥ã

### Microsoft PowerAutomateã§è¡Œã†æ¥­å‹™è‡ªå‹•åŒ–ã®å–ã‚Šçµ„ã¿ã¨èª²é¡Œï¼ˆç¬¬2å›ï¼‰

ä»Šæœã€PowerAutomateã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆé€šçŸ¥ãŒæ¥ã¦ã„ãŸã®ã§ã€ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’å®Ÿè¡Œã—ã¦å‹•ä½œç¢ºèªã‚’ã™ã‚‹æ©Ÿä¼šãŒã‚ã£ãŸã®ã§ã€ã¤ã„ã§ã«æ—¥é ƒä¸ä¾¿ã‚’æ„Ÿã˜ã¦ã„ãŸç‚¹ã‚’æ”¹å–„ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚

#### POSTã²ãªå½¢ãƒ•ã‚¡ã‚¤ãƒ«åã®å½¢å¼ã‚’æ”¹å–„ã—ã¾ã—ãŸ

ã€æ”¹å–„å‰ã€‘yyyy-MM-dd-HH-mm.'md'  
ã€æ”¹å–„1ã€‘yyyy-MM-dd>HH-mm.'md'(1å›ç›®)  
ã€æœŸå¾…åŠ¹æœã€‘ã²ãªå½¢ãƒ•ã‚¡ã‚¤ãƒ«ãŒæœ¬ç•ªãƒ•ã‚¡ã‚¤ãƒ«yyyy-MM-dd.'md'ã®ä¸‹ã«ä¸¦ã¶ã®ã§ä¸€è¦§æ€§ãŒè‰¯ããªã£ã¦ä½œæ¥­ãŒã¯ã‹ã©ã‚‹ã€‚  
ã€åŠ¹æœç¢ºèªã€‘æœŸå¾…é€šã‚Šã ã£ãŸãŒã€ãƒ­ãƒ¼ã‚«ãƒ«ã®gitã§pullå‡ºæ¥ãªã„ã¨ã„ã†éšœå®³ãŒã§ãŸã€‚éšœå®³ã®åŸå› ã¯è¨˜å·`<`ãŒãƒ•ã‚¡ã‚¤ãƒ«åã¨ã—ã¦githubå´ã§ç¦æ­¢ã•ã‚Œã¦ã„ã‚‹æ–‡å­—ã§ã‚ã£ãŸã“ã¨ã€‚  

---

ã€æ”¹å–„2ã€‘yyyy-MM-ddTHH-mm.'md'ï¼ˆ`>`ã‚’`T`ã«å¤‰æ›´ï¼‰

##### ğŸ“Œã“ã®è©±é¡Œã®&emsp;[å‰å›ã¸](https://github.com/yuasys/chatty-journal/blob/main/2023/08/2023-08-01.md#microsoft-power-automate%E3%81%A7%E3%81%8A%E8%A1%8C%E3%81%86%E6%A5%AD%E5%8B%99%E8%87%AA%E5%8B%95%E5%8C%96%E3%81%AE%E8%AA%B2%E9%A1%8C)&emsp;&emsp;[æ¬¡å›ã¸](https://github.com/yuasys/chatty-journal/blob/main/2023/08/2023-08-02.md#microsoft-powerautomate%E3%81%A7%E8%A1%8C%E3%81%86%E6%A5%AD%E5%8B%99%E8%87%AA%E5%8B%95%E5%8C%96%E3%81%AE%E5%8F%96%E3%82%8A%E7%B5%84%E3%81%BF%E3%81%A8%E8%AA%B2%E9%A1%8C%E7%AC%AC2%E5%9B%9E)

---

### ã€Node.js + Express + MySQL ã§ä½œã‚‹ å®‰å…¨ãª Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ å®Ÿè·µè¬›åº§ ã‚»ãƒƒã‚·ãƒ§ãƒ³11 No.50ã€‘ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°å‡ºåŠ›ã®ä½œæˆ

- [Udemyå­¦ç¿’ã®ã‚³ã‚³ã‹ã‚‰](https://www.udemy.com/course/web-application-with-nodejs-mysql/learn/lecture/27898240#notes)
`ï¼ˆæ³¨ï¼šã‚¢ã‚¯ã‚»ã‚¹æ¨©ã¯åˆ¶é™ã•ã‚Œã¦ã„ã¾ã™ï¼‰`

#### å¤§ã¾ã‹ãªæµã‚Œ

1. ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°å‡ºåŠ›ã®è¨­å®šã‚’è¿½åŠ 
2. ãƒ­ã‚°å‡ºåŠ›ã®å®Ÿè£…
3. ãƒ­ã‚°å‡ºåŠ›ã®å‹•ä½œç¢ºèª

#### æ‰‹é †

#### 1. ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°å‡ºåŠ›ç”¨ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’ç†è§£ã™ã‚‹

<p>
<img src="https://github.com/yuasys/chatty-journal/blob/main/images/Snapshot%202023-08-02%2009.31.37.png?raw=true" alt="log4jsãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢èª¬æ˜å›³1" width="640">
</p>

<p>
<img src="https://github.com/yuasys/chatty-journal/blob/main/images/Snapshot%202023-08-02%2010.33.24.png?raw=true" alt="log4jsãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢èª¬æ˜å›³2" width="640">
</p>

#### 2. å®Ÿè£…

<p>
<img src="https://github.com/yuasys/chatty-journal/blob/main/images/Snapshot%202023-08-02%2015.35.07.png?raw=true" alt="å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«" width="640">
</p>

1. `<root>/config/log4js.config.js`ã‚’ç·¨é›†

```javascript
const path = require("path");
const LOG_ROOT_DIR = process.env.LOG_ROOT_DIR || path.join(__dirname, "../logs");

module.exports = {
  appenders: {
    ConsoleLogAppender: {
      type: "console"
    },
    AppliationLogAppender: {
      type: "dateFile",
      filename: path.join(LOG_ROOT_DIR, "./application.log"),
      pattern: "yyyyMMdd",
      numBackups: 7  //ä¿®æ­£ï¼ˆå¤‰æ›´å‰ daysToKeep: 7)
    },
    AccessLogAppender: {         //è¿½è¨˜
      type: "dateFile",
      filename: path.join(LOG_ROOT_DIR, "./access.log"),
      pattern: "yyyyMMdd",
      numBackups: 7  //ä¿®æ­£ï¼ˆå¤‰æ›´å‰ daysToKeep: 7)
    }
  },
  categories: {
    "default": {
      appenders: ["ConsoleLogAppender"],
      level: "ALL"
    },
    "application": {
      appenders: [
        "AppliationLogAppender",
        "ConsoleLogAppender"
      ],
      level: "INFO"
    },
    "access": {           //è¿½åŠ 
      appenders: [
        "AccessLogAppender",
        "ConsoleLogAppender"
      ],
      level: "INFO"       //è¿½åŠ 
    }
  }
};
```

2. `<root>/lib/log/logger.js`ã‚’ç·¨é›†

```javascript
const log4js = require("log4js");
const config = require("../../config/log4js.config.js");
var console, application, access; //accessã‚’è¿½åŠ 

log4js.configure(config);

// Console logger
console = log4js.getLogger();

// Application logger
application = log4js.getLogger("application");

// Access logger
access = log4js.getLogger("access");  // è¿½åŠ 

module.exports = {
  console,
  application,
  access           //ã€€è¿½åŠ 
};
```

3. `<root>/lib/log/accesslogger.js`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ 

```javascript
const log4js = require("log4js");
const logger = require("./logger.js").access;
const DEFAULT_LOG_LEVEL = "auto";

module.exports = function (options) {
  options = options || {};
  options.level = options.level || DEFAULT_LOG_LEVEL;
  return log4js.connectLogger(logger, options);
};
```

4. `<root>/app.js`ã‚’ç·¨é›†

```javascript
const PORT = process.env.PORT || 3000;
const path = require("path");
const logger = require("./lib/log/logger.js");
const accesslogger = require("./lib/log/accesslogger.js");  //è¿½åŠ 
const applicationlogger = require("./lib/log/applicationlogger.js");
const express = require("express");
const favicon = require("serve-favicon");
const app = express();

// Express settings
app.set("view engine", "ejs");
app.disable("x-powered-by");

// Static resource rooting.
app.use(favicon(path.join(__dirname, "/public/favicon.ico")));
app.use("/public", express.static(path.join(__dirname, "/public")));

// Set access log.  //è¿½åŠ 
app.use(accesslogger());

// Dynamic resource rooting.
app.use("/", require("./routes/index.js"));

// Set application log.
app.use(applicationlogger());

// Execute web application.
app.listen(PORT, () => {
  logger.application.info(`Application listening at :${PORT}`);
});
```
